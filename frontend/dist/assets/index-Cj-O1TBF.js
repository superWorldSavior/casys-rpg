var T=Object.defineProperty;var $=(s,n,i)=>n in s?T(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i;var B=(s,n,i)=>$(s,typeof n!="symbol"?n+"":n,i);import{r as O,j as e,a as d,F as q}from"./index-CTdJZ5md.js";import{c as G,r as h}from"./vendor-BBF-xwg4.js";import{P as L}from"./PDFPreview-Dq2RCQZ1.js";import{i as z,j as H,b as o,d as m,e as _,P as N,G as f,S as l,s as U,t as J,v as I,n as Q,o as D,C as V,w as X,p as Y,x as K}from"./mui-CG_8jc0N.js";import{u as Z}from"./router-DvyW0KNU.js";import"./mui-deps-DIjIPAY3.js";import"./Close-jEuwfnBl.js";var y={},k=z;Object.defineProperty(y,"__esModule",{value:!0});var j=y.default=void 0,ee=k(O()),re=H;j=y.default=(0,ee.default)((0,re.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");class w extends G.Component{constructor(i){super(i);B(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,p){console.error("Error caught by boundary:",i,p),this.setState({errorInfo:p})}render(){return this.state.hasError?e(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"200px",p:3},children:d(N,{elevation:3,sx:{p:4,maxWidth:"600px",width:"100%",textAlign:"center"},children:[e(o,{component:"h2",sx:{fontSize:"1.5rem",fontWeight:500,mb:2,color:"error.main"},children:"Something went wrong"}),e(m,{variant:"body1",color:"text.secondary",sx:{mb:3},children:this.props.fallbackMessage||"An error occurred while rendering this component."}),!1,e(_,{variant:"contained",startIcon:e(j,{}),onClick:this.handleReset,sx:{mt:2},children:"Try Again"})]})}):this.props.children}}const te=({count:s=6})=>e(f,{container:!0,spacing:3,children:[...Array(s)].map((n,i)=>e(f,{item:!0,xs:12,sm:6,md:4,children:d(I,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e(l,{variant:"rectangular",height:200,animation:"wave",sx:{m:1}}),d(U,{sx:{flexGrow:1},children:[e(l,{variant:"text",height:32,width:"80%",sx:{mb:1}}),e(l,{variant:"text",height:24,width:"60%",sx:{mb:2}}),e(l,{variant:"rounded",height:24,width:"40%",sx:{mb:1}}),e(o,{sx:{mb:2},children:e(l,{variant:"rounded",height:32,width:"100%"})}),d(o,{sx:{display:"flex",gap:1},children:[e(l,{variant:"rounded",height:32,width:"30%"}),e(l,{variant:"rounded",height:32,width:"30%"}),e(l,{variant:"rounded",height:32,width:"30%"})]})]}),d(J,{sx:{p:2,justifyContent:"space-between"},children:[e(l,{variant:"rounded",width:100,height:36}),e(l,{variant:"rounded",width:100,height:36})]})]})},`skeleton-${i}`))}),ae=({books:s,onReadBook:n,onPreviewBook:i,theme:p})=>{const c=D(p.breakpoints.down("sm"));return e(o,{sx:{width:"100%",pb:2,overflowX:c?"auto":"hidden",WebkitOverflowScrolling:"touch","& .MuiGrid-container":{width:c?"auto":"100%",flexWrap:c?"nowrap":"wrap",px:c?2:0}},children:e(f,{container:!0,spacing:2,children:s.map((r,g)=>e(f,{item:!0,xs:8,sm:6,md:4,lg:3,sx:{flexShrink:0,width:c?"calc(150% - 16px)":"auto"},children:e(I,{sx:{height:"100%",position:"relative",cursor:(r==null?void 0:r.status)==="completed"?"pointer":"default",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:(r==null?void 0:r.status)==="completed"?"translateY(-4px)":"none",boxShadow:(r==null?void 0:r.status)==="completed"?6:1}},onClick:()=>(r==null?void 0:r.status)==="completed"&&n(r),children:d(o,{sx:{position:"relative",pt:"140%"},children:[e(K,{component:"img",image:`/api/books/${r.id}/cover`,alt:`Couverture de ${r.title}`,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}}),e(o,{sx:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%)",p:2,color:"white"},children:e(m,{variant:"h6",sx:{fontWeight:500,textShadow:"1px 1px 2px rgba(0,0,0,0.5)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(r==null?void 0:r.title)||"Sans titre"})})]})})},`book-${(r==null?void 0:r.id)||g}`))})})},ue=()=>{const[s,n]=h.useState([]),[i,p]=h.useState(!0);h.useState(!1);const[c,r]=h.useState(null),[g,A]=h.useState(""),[R,S]=h.useState(!1),[x,C]=h.useState(null),E=Q(),M=D(E.breakpoints.down("sm")),P=Z();h.useEffect(()=>{v();const t=setInterval(v,5e3);return()=>clearInterval(t)},[]);const v=async()=>{try{r(null),p(!0);const t=await fetch("/api/books");if(t.status===404){n([]);return}if(!t.ok){const a=await t.text();throw t.status>=500&&console.error(`Server error (${t.status}):`,a),new Error(`Impossible de charger la bibliothèque (${t.status})`)}let u;try{u=await t.json()}catch(a){throw console.error("Invalid JSON response:",a),new Error("Format de réponse invalide")}if(!u||typeof u!="object")throw new Error("Structure de données invalide");const F=(Array.isArray(u.books)?u.books:[]).map((a={})=>!a.id&&!a.filename?(console.warn("Book missing required identifier:",a),null):{id:a.id||a.filename,title:a.title||"Sans titre",author:a.author||"Auteur inconnu",filename:a.filename||"",uploadDate:a.uploadDate||new Date().toISOString(),status:a.status||"pending",current_page:parseInt(a.current_page,10)||0,total_pages:parseInt(a.total_pages,10)||0,processed_sections:parseInt(a.processed_sections,10)||0,processed_images:parseInt(a.processed_images,10)||0,error_message:a.error_message||null,...a}).filter(Boolean);n(F)}catch(t){t instanceof TypeError||t instanceof SyntaxError||console.error("Unexpected error fetching books:",t),r(t.message),n([])}finally{p(!1)}},b=t=>{if((t==null?void 0:t.status)!=="completed"){r("This book is not ready for reading yet");return}P(`/books/${t.id}`)},W=t=>{if((t==null?void 0:t.status)!=="completed"){r("This book is not ready for preview yet");return}C(t),S(!0)};return d(V,{maxWidth:"lg",sx:{py:4},children:[d(o,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,p:2,borderRadius:2,bgcolor:"background.paper"},children:[e(o,{children:e(m,{variant:M?"h5":"h4",sx:{fontWeight:500,color:"primary.main",mb:2},children:"Bibliothèque"})}),e(o,{sx:{display:"flex",gap:2,flexWrap:"wrap"}})]}),e(X,{open:!!g,autoHideDuration:6e3,onClose:()=>A(""),message:g}),c&&e(Y,{severity:"error",sx:{mb:3},onClose:()=>r(null),action:e(_,{color:"inherit",size:"small",onClick:v,children:"Retry"}),children:c}),i?e(w,{fallbackMessage:"Error displaying skeleton loader",children:e(te,{count:6})}):d(q,{children:[Array.isArray(s)&&s.length===0&&d(o,{sx:{textAlign:"center",mt:4,p:4,backgroundColor:"background.paper",borderRadius:2,border:1,borderColor:"divider"},children:[e(m,{variant:"h6",color:"text.secondary",children:"No books in library"}),e(m,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"Start by uploading a PDF"})]}),Array.isArray(s)&&s.length>0&&e(w,{fallbackMessage:"Error displaying book grid",children:e(ae,{books:s,onReadBook:b,onPreviewBook:W,theme:E})})]}),x&&e(w,{fallbackMessage:"Error displaying PDF preview",children:e(L,{open:R,onClose:()=>{S(!1),C(null)},pdfUrl:`/api/books/${x.filename}`,bookTitle:x.title})})]})};export{ue as default};
//# sourceMappingURL=index-Cj-O1TBF.js.map
