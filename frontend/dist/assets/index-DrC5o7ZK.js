import{i as e,j as t,b as o,d as r,z as n,D as s,s as a,E as i,F as l,e as c,n as u,L as d,q as h,H as p,J as x,K as g,M as m,N as f,f as b}from"./mui-4H20ALa5.js";import{r as v}from"./vendor-0_jEQBB2.js";import{r as j,d as C}from"./index-gBsZqlsV.js";import{d as k}from"./Close-D2xlRHaP.js";import{b as y,u as S}from"./router-Csy8SDXT.js";import"./mui-deps-DlUk4hWl.js";var w={},O=e;Object.defineProperty(w,"__esModule",{value:!0});var E=w.default=void 0,M=O(j()),T=t;E=w.default=(0,M.default)((0,T.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");var L={},z=e;Object.defineProperty(L,"__esModule",{value:!0});var D=L.default=void 0,F=z(j()),$=t;D=L.default=(0,F.default)((0,$.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings");const H={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},A={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},I="mousemove",P="mouseup";function R(e,t){if(0===t)return e;const o=Math.PI/180*t;return[e[0]*Math.cos(o)+e[1]*Math.sin(o),e[1]*Math.cos(o)-e[0]*Math.sin(o)]}function _(e){const{trackMouse:t}=e,o=v.useRef(Object.assign({},A)),r=v.useRef(Object.assign({},H)),n=v.useRef(Object.assign({},r.current));let s;for(s in n.current=Object.assign({},r.current),r.current=Object.assign(Object.assign({},H),e),H)void 0===r.current[s]&&(r.current[s]=H[s]);const[a,i]=v.useMemo((()=>function(e,t){const o=t=>{const o="touches"in t;o&&t.touches.length>1||e(((e,n)=>{n.trackMouse&&!o&&(document.addEventListener(I,r),document.addEventListener(P,s));const{clientX:a,clientY:i}=o?t.touches[0]:t,l=R([a,i],n.rotationAngle);return n.onTouchStartOrOnMouseDown&&n.onTouchStartOrOnMouseDown({event:t}),Object.assign(Object.assign(Object.assign({},e),A),{initial:l.slice(),xy:l,start:t.timeStamp||0})}))},r=t=>{e(((e,o)=>{const r="touches"in t;if(r&&t.touches.length>1)return e;if(t.timeStamp-e.start>o.swipeDuration)return e.swiping?Object.assign(Object.assign({},e),{swiping:!1}):e;const{clientX:n,clientY:s}=r?t.touches[0]:t,[a,i]=R([n,s],o.rotationAngle),l=a-e.xy[0],c=i-e.xy[1],u=Math.abs(l),d=Math.abs(c),h=(t.timeStamp||0)-e.start,p=Math.sqrt(u*u+d*d)/(h||1),x=[l/(h||1),c/(h||1)],g=function(e,t,o,r){return e>t?o>0?"Right":"Left":r>0?"Down":"Up"}(u,d,l,c),m="number"==typeof o.delta?o.delta:o.delta[g.toLowerCase()]||H.delta;if(u<m&&d<m&&!e.swiping)return e;const f={absX:u,absY:d,deltaX:l,deltaY:c,dir:g,event:t,first:e.first,initial:e.initial,velocity:p,vxvy:x};f.first&&o.onSwipeStart&&o.onSwipeStart(f),o.onSwiping&&o.onSwiping(f);let b=!1;return(o.onSwiping||o.onSwiped||o[`onSwiped${g}`])&&(b=!0),b&&o.preventScrollOnSwipe&&o.trackTouch&&t.cancelable&&t.preventDefault(),Object.assign(Object.assign({},e),{first:!1,eventData:f,swiping:!0})}))},n=t=>{e(((e,o)=>{let r;if(e.swiping&&e.eventData){if(t.timeStamp-e.start<o.swipeDuration){r=Object.assign(Object.assign({},e.eventData),{event:t}),o.onSwiped&&o.onSwiped(r);const n=o[`onSwiped${r.dir}`];n&&n(r)}}else o.onTap&&o.onTap({event:t});return o.onTouchEndOrOnMouseUp&&o.onTouchEndOrOnMouseUp({event:t}),Object.assign(Object.assign(Object.assign({},e),A),{eventData:r})}))},s=e=>{document.removeEventListener(I,r),document.removeEventListener(P,s),n(e)},a=(e,t)=>{let s=()=>{};if(e&&e.addEventListener){const a=Object.assign(Object.assign({},H.touchEventOptions),t.touchEventOptions),i=[["touchstart",o,a],["touchmove",r,Object.assign(Object.assign({},a),t.preventScrollOnSwipe?{passive:!1}:{})],["touchend",n,a]];i.forEach((([t,o,r])=>e.addEventListener(t,o,r))),s=()=>i.forEach((([t,o])=>e.removeEventListener(t,o)))}return s},i={ref:t=>{null!==t&&e(((e,o)=>{if(e.el===t)return e;const r={};return e.el&&e.el!==t&&e.cleanUpTouch&&(e.cleanUpTouch(),r.cleanUpTouch=void 0),o.trackTouch&&t&&(r.cleanUpTouch=a(t,o)),Object.assign(Object.assign(Object.assign({},e),{el:t}),r)}))}};return t.trackMouse&&(i.onMouseDown=o),[i,a]}((e=>o.current=e(o.current,r.current)),{trackMouse:t})),[t]);return o.current=function(e,t,o,r){return t.trackTouch&&e.el?e.cleanUpTouch?t.preventScrollOnSwipe!==o.preventScrollOnSwipe||t.touchEventOptions.passive!==o.touchEventOptions.passive?(e.cleanUpTouch(),Object.assign(Object.assign({},e),{cleanUpTouch:r(e.el,t)})):e:Object.assign(Object.assign({},e),{cleanUpTouch:r(e.el,t)}):(e.cleanUpTouch&&e.cleanUpTouch(),Object.assign(Object.assign({},e),{cleanUpTouch:void 0}))}(o.current,r.current,n.current,i),a}var U={},B=e;Object.defineProperty(U,"__esModule",{value:!0});var V=U.default=void 0,W=B(j()),q=t;V=U.default=(0,W.default)((0,q.jsx)("path",{d:"M9 4v3h5v12h3V7h5V4zm-6 8h3v7h3v-7h3V9H3z"}),"FormatSize");var X={},G=e;Object.defineProperty(X,"__esModule",{value:!0});var N=X.default=void 0,Y=G(j()),J=t;N=X.default=(0,Y.default)((0,J.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6"}),"Brightness4");var K={},Q=e;Object.defineProperty(K,"__esModule",{value:!0});var Z=K.default=void 0,ee=Q(j()),te=t;Z=K.default=(0,ee.default)((0,te.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6m0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4"}),"Brightness7");var oe={},re=e;Object.defineProperty(oe,"__esModule",{value:!0});var ne=oe.default=void 0,se=re(j()),ae=t;function ie({speed:e,setSpeed:s}){return t.jsxs(o,{sx:{width:"100%",mt:2},children:[t.jsxs(r,{gutterBottom:!0,variant:"subtitle1",sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(ne,{})," Reading Speed"]}),t.jsx(n,{value:e,min:1,max:10,step:1,marks:!0,onChange:(e,t)=>s(t),valueLabelDisplay:"auto","aria-label":"Reading speed"})]})}ne=oe.default=(0,se.default)((0,ae.jsx)("path",{d:"m20.38 8.57-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83"}),"Speed");const le={light:{name:"Jour",backgroundColor:"#F6F3E9",textColor:"#2c2c2c"},sepia:{name:"Sépia",backgroundColor:"#F4ECD8",textColor:"#5C4B37"},dark:{name:"Nuit",backgroundColor:"#131516",textColor:"#e1e1e1"},warmLight:{name:"Lumière chaude",backgroundColor:"#FCF8E8",textColor:"#4A4A4A"},green:{name:"Vert doux",backgroundColor:"#E8F3E8",textColor:"#2C3E2C"}},ce=({open:e,onClose:u,speed:d,onSpeedChange:h,theme:p,onThemeChange:x,onExitReader:g})=>{const m=p||le.light;return t.jsxs(s,{anchor:"right",open:e,onClose:u,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:400},p:3}},children:[t.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(r,{variant:"h6",children:"Paramètres de lecture"}),t.jsx(a,{onClick:u,children:t.jsx(k,{})})]}),t.jsx(i,{sx:{mb:3}}),t.jsxs(o,{sx:{mb:3},children:[t.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Taille du texte"}),t.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(V,{sx:{fontSize:"1rem"}}),t.jsx(n,{value:parseInt((null==m?void 0:m.fontSize)||"16px")||16,min:14,max:24,step:1,onChange:(e,t)=>x("fontSize",`${t}px`),sx:{flexGrow:1},marks:[{value:14,label:"A"},{value:19,label:"A"},{value:24,label:"A"}]}),t.jsx(V,{sx:{fontSize:"1.5rem"}})]})]}),t.jsx(i,{sx:{my:3}}),t.jsxs(o,{sx:{mb:3},children:[t.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Vitesse de défilement"}),t.jsx(ie,{speed:d,setSpeed:h})]}),t.jsx(i,{sx:{my:3}}),t.jsxs(o,{sx:{mb:3},children:[t.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Thème"}),t.jsx(l,{variant:"outlined",fullWidth:!0,children:Object.entries(le).map((([e,o])=>t.jsx(c,{onClick:()=>x("theme",o),variant:m.backgroundColor===o.backgroundColor?"contained":"outlined",startIcon:"dark"===e?t.jsx(N,{}):t.jsx(Z,{}),sx:{bgcolor:o.backgroundColor,color:o.textColor,"&:hover":{bgcolor:o.backgroundColor,opacity:.9}},children:o.name},e)))})]})]})},ue="kindle-reader-state",de=({content:e=[],initialSection:n=0,bookId:s,onProgressChange:a,customTheme:i})=>{const l=u(),[h,p]=v.useState((()=>{return i||{fontFamily:'"Bookerly", "Georgia", serif',fontSize:"1.2rem",lineHeight:"1.8",textColor:(e="dark"===l.palette.mode)?"#e1e1e1":"#2c2c2c",backgroundColor:e?"#131516":"#F6F3E9"};var e})),x=v.useRef(!1),g=v.useRef(e),[m,f]=v.useState(n),[b,j]=v.useState(""),[C,k]=v.useState(!1),[y,S]=v.useState(!1),[w,O]=v.useState(!1),[E,M]=v.useState(0),[T,L]=v.useState(30),[z,D]=v.useState(null),[F,$]=v.useState(!1);v.useState(!1);const H=v.useMemo((()=>e?(Array.isArray(e)?e:[e]).map(((e,t)=>{var o;try{if("string"==typeof e){const r=e.split("\n");return{content:e,number:t+1,title:(null==(o=r[0])?void 0:o.startsWith("#"))?r[0].replace(/^#+\s*/,""):`Section ${t+1}`,key:`section-${t}`}}return{...e,number:t+1,title:e.title||`Section ${t+1}`,key:`section-${t}`}}catch(r){return{content:"Erreur de chargement de la section",number:t+1,title:`Section ${t+1}`,key:`section-${t}`}}})):[]),[e]),A=v.useCallback((e=>{if(C)return;const t=document.querySelector(".kindle-reader-content");t&&(t.style.transition="opacity 0.3s, transform 0.3s",t.style.opacity="0",t.style.transform=`translateX(${-30*e}px)`,setTimeout((()=>{f((t=>{const o=t+e;return Math.max(0,Math.min(o,H.length-1))})),setTimeout((()=>{t.style.transition="opacity 0.3s, transform 0.3s",t.style.opacity="1",t.style.transform="translateX(0)"}),50)}),300))}),[C,H.length]);v.useCallback(((e,t=1)=>{if(!e)return;const o=()=>{e.scrollHeight-e.scrollTop===e.clientHeight||(e.scrollBy({top:t,behavior:"smooth"}),requestAnimationFrame(o))};requestAnimationFrame(o)}),[]);const I=v.useCallback((async e=>{if(!e)return;const t="string"==typeof e?e:e.content||"";try{k(!1),D(null),j(t),a&&a(100)}catch(o){D("Erreur lors de l'affichage du texte"),k(!1)}}),[a]),P=v.useCallback((e=>{if(!e)return!1;const t=e.scrollTop+e.clientHeight,o=e.scrollHeight;S(t>=o-100)}),[]),R=v.useMemo((()=>({keyboard:e=>{"ArrowLeft"===e.key?A(-1):"ArrowRight"===e.key?A(1):"Escape"===e.key&&(x.current=!0,k(!1))},swipe:{onSwipedLeft:()=>A(1),onSwipedRight:()=>A(-1),preventDefaultTouchmoveEvent:!0,trackMouse:!0}})),[A]),U=_({...R.swipe,delta:50,preventDefaultTouchmoveEvent:!0,trackTouch:!0,trackMouse:!1,rotationAngle:0,touchEventOptions:{passive:!1}});v.useEffect((()=>{g.current=e}),[e]),v.useEffect((()=>{p((e=>({...e,textColor:"dark"===l.palette.mode?"#e1e1e1":"#2c2c2c",backgroundColor:"dark"===l.palette.mode?"#131516":"#F6F3E9"})))}),[l.palette.mode]),v.useEffect((()=>{O(0===H.length)}),[H]),v.useEffect((()=>{if(!s||void 0===m)return;const e={currentSection:m,progress:E,timestamp:Date.now(),theme:h,speed:T};localStorage.setItem(`${ue}-${s}`,JSON.stringify(e)),document.title=`Lecture en cours - ${Math.round(E)}%`}),[s,m,E,h,T]),v.useEffect((()=>{if(!s)return;const e=localStorage.getItem(`${ue}-${s}`);if(e){const{currentSection:t}=JSON.parse(e);f(t)}}),[s]),v.useEffect((()=>(window.addEventListener("keydown",R.keyboard),()=>window.removeEventListener("keydown",R.keyboard))),[R]),v.useEffect((()=>((async()=>{if(!w&&H.length>0){D(null),k(!1);const t=n>=0&&n<H.length?n:m;if(t>=0&&t<H.length){const o=H[t],r="string"==typeof o?o:null==o?void 0:o.content;if(r){M(0),x.current=!1;try{await I(r)}catch(e){D("Erreur lors de l'affichage du texte"),j(r)}}else D("Format de contenu invalide")}}})(),()=>{x.current=!0})),[H,m,n,I,w]);return(!H.length||w?t.jsxs(o,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:h.backgroundColor,gap:2,children:[t.jsx(r,{variant:"h5",sx:{color:h.textColor},children:"Chargement du contenu..."}),!H.length&&t.jsx(r,{variant:"body2",sx:{color:h.textColor},children:"Veuillez patienter pendant le chargement de votre livre"})]}):z?t.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:h.backgroundColor,children:t.jsx(r,{variant:"h5",sx:{color:h.textColor},children:z})}):null)||t.jsxs(o,{...U,sx:{position:"relative",height:"100vh",width:"100vw",bgcolor:h.backgroundColor,color:h.textColor,p:0,m:0,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs(o,{sx:{position:"fixed",top:0,left:0,right:0,zIndex:1100,bgcolor:h.backgroundColor,borderBottom:1,borderColor:"divider",boxShadow:1},children:[t.jsx(d,{variant:"determinate",value:m/(e.length||1)*100,sx:{height:"3px",backgroundColor:"rgba(0, 0, 0, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:h.textColor,transition:"transform 0.3s ease-out"}}}),t.jsx(r,{variant:"caption",sx:{position:"absolute",right:"8px",top:"8px",padding:"4px 8px",borderRadius:"12px",backgroundColor:"rgba(0, 0, 0, 0.1)",color:h.textColor,fontSize:"0.75rem",fontWeight:500},children:`${Math.round(E)}%`})]}),t.jsxs(o,{className:"kindle-reader-content",ref:e=>{e&&e.addEventListener("scroll",(()=>P(e)))},sx:{maxWidth:"65ch",mx:"auto",mt:"48px",pt:{xs:"24px",sm:"32px"},pb:{xs:"96px",sm:"104px"},px:{xs:4,sm:5},overflowY:"auto",height:"calc(100vh - 48px)",position:"relative",scrollBehavior:"smooth",fontSize:{xs:"1.1rem",sm:"1.2rem",md:"1.25rem"},"& p":{mb:2,textAlign:"justify",hyphens:"auto",lineHeight:1.8},"& h1, & h2":{textAlign:"center",mb:3},whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:h.fontFamily,lineHeight:h.lineHeight,"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:e=>`${h.textColor}33`,borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{background:e=>`${h.textColor}66`},scrollbarWidth:"thin",scrollbarColor:e=>`${h.textColor}33 transparent`},children:[b,y&&t.jsxs(o,{sx:{textAlign:"center",mt:4,p:2,borderRadius:1,bgcolor:"rgba(0, 0, 0, 0.05)"},children:[t.jsx(r,{variant:"body2",sx:{mb:2,color:h.textColor},children:"Faites défiler ou cliquez pour passer au chapitre suivant"}),t.jsx(c,{variant:"contained",onClick:()=>A(1),sx:{bgcolor:h.textColor,color:h.backgroundColor,"&:hover":{bgcolor:h.textColor,opacity:.9}},children:"Chapitre suivant"})]})]}),t.jsx(ce,{open:F,onClose:()=>$(!1),theme:h,speed:T,onSpeedChange:L,onThemeChange:(e,t)=>{p((o=>({...o,[e]:t})))}})]})};var he={},pe=e;Object.defineProperty(he,"__esModule",{value:!0});var xe=he.default=void 0,ge=pe(j()),me=t;function fe({onCommand:e}){const[r,n]=v.useState("");return t.jsxs(o,{component:"form",onSubmit:t=>{t.preventDefault(),r.trim()&&(e(r.trim().toLowerCase()),n(""))},sx:{mt:2,display:"flex",gap:1},children:[t.jsx(h,{fullWidth:!0,value:r,onChange:e=>n(e.target.value),placeholder:"Enter command (type 'help' for available commands)",size:"small"}),t.jsx(c,{type:"submit",variant:"contained",endIcon:t.jsx(xe,{}),children:"Send"})]})}xe=he.default=(0,ge.default)((0,me.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");var be={},ve=e;Object.defineProperty(be,"__esModule",{value:!0});var je=be.default=void 0,Ce=ve(j()),ke=t;function ye({chapters:e,currentSection:n,onChapterSelect:a,open:i,onClose:l,onSettingsClick:c,onExitReader:u}){return t.jsx(s,{anchor:"left",open:i,onClose:l,PaperProps:{sx:{width:280,bgcolor:"background.default",color:"text.primary"}},children:t.jsxs(o,{sx:{p:2},children:[t.jsxs(r,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[t.jsx(C,{})," Feuille d'aventure"]}),t.jsxs(p,{children:[t.jsx(x,{disablePadding:!0,children:t.jsxs(g,{onClick:c,children:[t.jsx(m,{sx:{color:"text.primary"},children:t.jsx(D,{})}),t.jsx(f,{primary:"Paramètres"})]})}),t.jsx(x,{disablePadding:!0,children:t.jsxs(g,{onClick:u,children:[t.jsx(m,{sx:{color:"text.primary"},children:t.jsx(je,{})}),t.jsx(f,{primary:"Quitter"})]})})]})]})})}je=be.default=(0,Ce.default)((0,ke.jsx)("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout");const Se={fontFamily:'"Bookerly", "Georgia", serif',fontSize:"1.2rem",textColor:"#2c2c2c",backgroundColor:"#F6F3E9",lineHeight:"1.8"},we={...Se,textColor:"#e1e1e1",backgroundColor:"#131516"};function Oe(){const{bookId:e}=y();S();const n=u(),[s,i]=v.useState(""),[l,h]=v.useState(0),[p,x]=v.useState(0),[g,m]=v.useState(!0),[f,j]=v.useState(null),[C,k]=v.useState(!1),[w,O]=v.useState((()=>"dark"===n.palette.mode?we:Se));v.useEffect((()=>{O("dark"===n.palette.mode?we:Se)}),[n.palette.mode]);const M=async t=>{try{m(!0),j(null);const o=await fetch(`/api/books/${e}/chapters/${t}`);if(!o.ok)throw new Error("Erreur lors du chargement du chapitre.");const r=await o.json();i(r.chapter),h(r.index)}catch(o){j(o.message)}finally{m(!1)}};v.useEffect((()=>{(async()=>{try{const t=await fetch(`/api/books/${e}/chapters`);if(!t.ok)throw new Error("Erreur lors du chargement des chapitres.");const o=await t.json();x(o.chapters.length),M(0)}catch(t){j(t.message)}})()}),[e]);const[T,L]=v.useState(0);return g?t.jsx(o,{sx:{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:w.backgroundColor,color:w.textColor},children:t.jsx(b,{})}):f?t.jsxs(o,{sx:{height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:w.backgroundColor,color:w.textColor,padding:2},children:[t.jsx(r,{variant:"h6",children:f}),t.jsx(c,{onClick:()=>M(l),variant:"contained",sx:{marginTop:2},children:"Réessayer"})]}):t.jsxs(o,{sx:{height:"100vh",width:"100vw",overflow:"hidden",bgcolor:w.backgroundColor,color:w.textColor,position:"relative",display:"flex",flexDirection:"column"},children:[t.jsxs(o,{component:"header",sx:{position:"sticky",top:0,left:0,right:0,zIndex:1e3,bgcolor:`${w.backgroundColor}CC`,borderBottom:1,borderColor:"divider",px:2,py:1,display:"flex",alignItems:"center",gap:2,backdropFilter:"blur(8px)"},children:[t.jsx(a,{onClick:()=>k(!0),sx:{color:w.textColor},children:t.jsx(E,{})}),t.jsx(d,{variant:"determinate",value:l/p*100,sx:{flexGrow:1,"& .MuiLinearProgress-bar":{backgroundColor:w.textColor}}})]}),t.jsx(ye,{open:C,onClose:()=>k(!1),chapters:Array(p).fill(""),currentSection:l,onChapterSelect:e=>{M(e),k(!1)}}),t.jsxs(o,{sx:{flexGrow:1,position:"relative",overflow:"hidden"},children:[t.jsx(de,{content:s||[],initialSection:0,bookId:e,customTheme:w,onProgressChange:t=>{localStorage.setItem(`reading-progress-${e}`,t.toString())}}),t.jsxs(o,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:w.backgroundColor,borderTop:1,borderColor:"divider",zIndex:1e3},children:[t.jsx(fe,{onCommand:e=>{switch(e.toLowerCase()){case"next":l<p-1&&(M(l+1),L(0));break;case"prev":l>0&&(M(l-1),L(0))}}}),t.jsxs(r,{variant:"caption",sx:{position:"absolute",right:16,bottom:16,opacity:.7},children:[l+1," / ",p]})]})]})]})}export{Oe as default};
