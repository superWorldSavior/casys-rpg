import{i as e,j as t,b as o,d as r,z as n,D as a,s as l,E as s,F as i,e as c,L as d,q as u,H as h,J as x,K as p,M as m,N as g,n as f,f as b}from"./mui-4H20ALa5.js";import{r as v}from"./vendor-0_jEQBB2.js";import{r as C,d as j}from"./index-CgZOgMeD.js";import{d as y}from"./Close-xbK16gS_.js";import{b as k,u as S}from"./router-Csy8SDXT.js";import"./mui-deps-DlUk4hWl.js";var w={},M=e;Object.defineProperty(w,"__esModule",{value:!0});var E=w.default=void 0,z=M(C()),L=t;E=w.default=(0,z.default)((0,L.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");var H={},I=e;Object.defineProperty(H,"__esModule",{value:!0});var F=H.default=void 0,P=I(C()),$=t;F=H.default=(0,P.default)((0,$.jsx)("path",{d:"M9 4v3h5v12h3V7h5V4zm-6 8h3v7h3v-7h3V9H3z"}),"FormatSize");var A={},_=e;Object.defineProperty(A,"__esModule",{value:!0});var T=A.default=void 0,B=_(C()),V=t;T=A.default=(0,B.default)((0,V.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6"}),"Brightness4");var D={},O=e;Object.defineProperty(D,"__esModule",{value:!0});var R=D.default=void 0,X=O(C()),W=t;R=D.default=(0,X.default)((0,W.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6m0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4"}),"Brightness7");var G={},N=e;Object.defineProperty(G,"__esModule",{value:!0});var J=G.default=void 0,q=N(C()),K=t;function Q({speed:e,setSpeed:a}){return t.jsxs(o,{sx:{width:"100%",mt:2},children:[t.jsxs(r,{gutterBottom:!0,variant:"subtitle1",sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(J,{})," Reading Speed"]}),t.jsx(n,{value:e,min:1,max:10,step:1,marks:!0,onChange:(e,t)=>a(t),valueLabelDisplay:"auto","aria-label":"Reading speed"})]})}J=G.default=(0,q.default)((0,K.jsx)("path",{d:"m20.38 8.57-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83"}),"Speed");const Y={light:{name:"Jour",backgroundColor:"#F6F3E9",textColor:"#2c2c2c"},sepia:{name:"Sépia",backgroundColor:"#F4ECD8",textColor:"#5C4B37"},dark:{name:"Nuit",backgroundColor:"#131516",textColor:"#e1e1e1"},warmLight:{name:"Lumière chaude",backgroundColor:"#FCF8E8",textColor:"#4A4A4A"},green:{name:"Vert doux",backgroundColor:"#E8F3E8",textColor:"#2C3E2C"}},U=({open:e,onClose:d,speed:u,onSpeedChange:h,theme:x,onThemeChange:p,onExitReader:m})=>{const g=x||Y.light;return t.jsxs(a,{anchor:"right",open:e,onClose:d,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:400},p:3}},children:[t.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(r,{variant:"h6",children:"Paramètres de lecture"}),t.jsx(l,{onClick:d,children:t.jsx(y,{})})]}),t.jsx(s,{sx:{mb:3}}),t.jsxs(o,{sx:{mb:3},children:[t.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Taille du texte"}),t.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(F,{sx:{fontSize:"1rem"}}),t.jsx(n,{value:parseInt((null==g?void 0:g.fontSize)||"16px")||16,min:14,max:24,step:1,onChange:(e,t)=>p("fontSize",`${t}px`),sx:{flexGrow:1},marks:[{value:14,label:"A"},{value:19,label:"A"},{value:24,label:"A"}]}),t.jsx(F,{sx:{fontSize:"1.5rem"}})]})]}),t.jsx(s,{sx:{my:3}}),t.jsxs(o,{sx:{mb:3},children:[t.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Vitesse de défilement"}),t.jsx(Q,{speed:u,setSpeed:h})]}),t.jsx(s,{sx:{my:3}}),t.jsxs(o,{sx:{mb:3},children:[t.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Thème"}),t.jsx(i,{variant:"outlined",fullWidth:!0,children:Object.entries(Y).map((([e,o])=>t.jsx(c,{onClick:()=>p("theme",o),variant:g.backgroundColor===o.backgroundColor?"contained":"outlined",startIcon:"dark"===e?t.jsx(T,{}):t.jsx(R,{}),sx:{bgcolor:o.backgroundColor,color:o.textColor,"&:hover":{bgcolor:o.backgroundColor,opacity:.9}},children:o.name},e)))})]})]})},Z="kindle-reader",ee=({content:e=[],initialSection:n=0,bookId:a,theme:l,onProgressChange:s})=>{const[i,u]=v.useState(n),[h,x]=v.useState(""),[p,m]=v.useState(!1),[g,f]=v.useState(0),[b,C]=v.useState(null),[j,y]=v.useState(!0),[k,S]=v.useState(!1),[w,M]=v.useState(5),[E,z]=v.useState(!1),L=v.useRef(!1),H=v.useRef(null),I=Array.isArray(e)?e:[e],[F,P]=v.useState({backgroundColor:(null==l?void 0:l.backgroundColor)||"#F6F3E9",textColor:(null==l?void 0:l.textColor)||"#2c2c2c",fontFamily:(null==l?void 0:l.fontFamily)||'"Bookerly", "Georgia", serif',fontSize:(null==l?void 0:l.fontSize)||"1.2rem",lineHeight:(null==l?void 0:l.lineHeight)||1.8}),$=v.useCallback((async e=>{if(!e)return;const t=("string"==typeof e?e:e.content||"").split(/\s+/);try{m(!0),C(null),x("");const e=(e=>{const t=Math.min(Math.max(e,1),10),o=Math.pow(t/5,1.5);return Math.round(30/o)})(w);let o="";for(let r=0;r<t.length&&!L.current;r++){o+=(r>0?" ":"")+t[r],x(o),f((r+1)/t.length*100),s&&s((r+1)/t.length*100);const n=/[,.!?]$/.test(t[r]);await new Promise((t=>setTimeout(t,n?1.5*e:e)))}m(!1)}catch(o){C("Erreur lors de l'affichage du texte"),m(!1)}}),[s,w]),A=v.useCallback((e=>{if(!e)return;const{scrollTop:t,scrollHeight:o,clientHeight:r}=e;z(t+r>=o-100)}),[]),_={keyboard:v.useCallback((e=>{p||("ArrowRight"===e.key||"Space"===e.key?i<I.length-1&&u((e=>e+1)):"ArrowLeft"===e.key&&i>0&&u((e=>e-1)))}),[i,p,I.length])},T={onTouchStart:e=>{const t=e.touches[0];H.current={x:t.clientX}},onTouchMove:e=>{if(!H.current||p)return;const t=e.touches[0],o=H.current.x-t.clientX,r=document.querySelector(".kindle-reader-content");r&&(r.style.transform=`translateX(${-o}px)`,r.style.transition="transform 0.1s ease-out",Math.abs(o)>50&&(o>0&&i<I.length-1?(r.style.transform="translateX(-100%)",setTimeout((()=>{u((e=>e+1)),r.style.transform="translateX(0)"}),300)):o<0&&i>0&&(r.style.transform="translateX(100%)",setTimeout((()=>{u((e=>e-1)),r.style.transform="translateX(0)"}),300)),H.current=null))},onTouchEnd:()=>{H.current=null}};return v.useEffect((()=>{y(0===I.length)}),[I]),v.useEffect((()=>{if(!a||void 0===i)return;const e={currentSection:i,progress:g,timestamp:Date.now(),theme:F,speed:w};localStorage.setItem(`${Z}-${a}`,JSON.stringify(e)),document.title=`Lecture en cours - ${Math.round(g)}%`}),[a,i,g,F,w]),v.useEffect((()=>{if(s){const e=(100*i+g)/I.length;s(Math.min(e,100))}}),[i,g,I.length,s]),v.useEffect((()=>{if(!a)return;const e=localStorage.getItem(`${Z}-${a}`);if(e){const{currentSection:t}=JSON.parse(e);u(t)}}),[a]),v.useEffect((()=>(window.addEventListener("keydown",_.keyboard),()=>window.removeEventListener("keydown",_.keyboard))),[_]),v.useEffect((()=>((async()=>{if(!j&&I.length>0){C(null),m(!1);const t=n>=0&&n<I.length?n:i;if(t>=0&&t<I.length){const o=I[t],r="string"==typeof o?o:null==o?void 0:o.content;if(r){f(0),L.current=!1;try{await $(r)}catch(e){C("Erreur lors de l'affichage du texte"),x(r)}}else C("Format de contenu invalide")}}})(),()=>{L.current=!0})),[I,i,n,$,j]),!I.length||j?t.jsxs(o,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:F.backgroundColor,gap:2,children:[t.jsx(r,{variant:"h5",sx:{color:F.textColor},children:"Chargement du contenu..."}),!I.length&&t.jsx(r,{variant:"body2",sx:{color:F.textColor},children:"Veuillez patienter pendant le chargement de votre livre"})]}):b?t.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:F.backgroundColor,children:t.jsx(r,{variant:"h5",sx:{color:F.textColor},children:b})}):t.jsxs(o,{...T,sx:{position:"relative",height:"100vh",width:"100vw",bgcolor:F.backgroundColor,color:F.textColor,p:0,m:0,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs(o,{sx:{position:"fixed",top:0,left:0,right:0,zIndex:1100,bgcolor:F.backgroundColor,borderBottom:1,borderColor:"divider",boxShadow:1},children:[t.jsx(d,{variant:"determinate",value:i/I.length*100,sx:{height:"3px",backgroundColor:"rgba(0, 0, 0, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:F.textColor,transition:"transform 0.3s ease-out"}}}),t.jsx(r,{variant:"caption",sx:{position:"absolute",right:"8px",top:"8px",padding:"4px 8px",borderRadius:"12px",backgroundColor:"rgba(0, 0, 0, 0.1)",color:F.textColor,fontSize:"0.75rem",fontWeight:500},children:`${Math.round(g)}%`})]}),t.jsxs(o,{className:"kindle-reader-content",ref:e=>{e&&e.addEventListener("scroll",(()=>A(e)))},sx:{maxWidth:"65ch",mx:"auto",height:"calc(100vh - 128px)",position:"relative",overflowY:"auto",display:"flex",flexDirection:"column",pt:"64px",pb:"64px",px:{xs:3,sm:4},"& > *:first-of-type":{mt:0},scrollBehavior:"smooth",fontSize:{xs:"1.1rem",sm:"1.2rem",md:"1.25rem"},"& p":{mb:2,textAlign:"justify",hyphens:"auto",lineHeight:1.8},"& h1, & h2":{textAlign:"center",mb:3},whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:F.fontFamily,lineHeight:F.lineHeight,"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:e=>`${F.textColor}33`,borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{background:e=>`${F.textColor}66`},scrollbarWidth:"thin",scrollbarColor:e=>`${F.textColor}33 transparent`},children:[h,E&&t.jsx(o,{sx:{mt:4,mb:4,textAlign:"center",p:2,borderRadius:1,bgcolor:"rgba(0, 0, 0, 0.05)"},children:t.jsx(c,{variant:"contained",onClick:()=>{i<I.length-1&&u((e=>e+1))},sx:{bgcolor:F.textColor,color:F.backgroundColor,"&:hover":{bgcolor:F.textColor,opacity:.9}},children:"Chapitre suivant"})})]}),t.jsx(U,{open:k,onClose:()=>S(!1),theme:F,speed:w,onSpeedChange:M,onThemeChange:(e,t)=>{P((o=>({...o,[e]:t})))}})]})};var te={},oe=e;Object.defineProperty(te,"__esModule",{value:!0});var re=te.default=void 0,ne=oe(C()),ae=t;function le({onCommand:e}){const[r,n]=v.useState("");return t.jsxs(o,{component:"form",onSubmit:t=>{t.preventDefault(),r.trim()&&(e(r.trim().toLowerCase()),n(""))},sx:{mt:2,display:"flex",gap:1},children:[t.jsx(u,{fullWidth:!0,value:r,onChange:e=>n(e.target.value),placeholder:"Enter command (type 'help' for available commands)",size:"small"}),t.jsx(c,{type:"submit",variant:"contained",endIcon:t.jsx(re,{}),children:"Send"})]})}re=te.default=(0,ne.default)((0,ae.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");var se={},ie=e;Object.defineProperty(se,"__esModule",{value:!0});var ce=se.default=void 0,de=ie(C()),ue=t;ce=se.default=(0,de.default)((0,ue.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings");var he={},xe=e;Object.defineProperty(he,"__esModule",{value:!0});var pe=he.default=void 0,me=xe(C()),ge=t;function fe({chapters:e,currentSection:n,onChapterSelect:l,open:s,onClose:i,onSettingsClick:c,onExitReader:d}){return t.jsx(a,{anchor:"left",open:s,onClose:i,PaperProps:{sx:{width:280,bgcolor:"background.default",color:"text.primary"}},children:t.jsxs(o,{sx:{p:2},children:[t.jsxs(r,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[t.jsx(j,{})," Feuille d'aventure"]}),t.jsxs(h,{children:[t.jsx(x,{disablePadding:!0,children:t.jsxs(p,{onClick:c,children:[t.jsx(m,{sx:{color:"text.primary"},children:t.jsx(ce,{})}),t.jsx(g,{primary:"Paramètres"})]})}),t.jsx(x,{disablePadding:!0,children:t.jsxs(p,{onClick:d,children:[t.jsx(m,{sx:{color:"text.primary"},children:t.jsx(pe,{})}),t.jsx(g,{primary:"Quitter"})]})})]})]})})}pe=he.default=(0,me.default)((0,ge.jsx)("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout");const be={fontFamily:'"Bookerly", "Georgia", serif',fontSize:"1.2rem",textColor:"#2c2c2c",backgroundColor:"#F6F3E9",lineHeight:"1.8"},ve={...be,textColor:"#e1e1e1",backgroundColor:"#131516"};function Ce(){const{bookId:e}=k();S();const n=f(),[a,s]=v.useState(""),[i,u]=v.useState(0),[h,x]=v.useState(0),[p,m]=v.useState(!0),[g,C]=v.useState(null),[j,y]=v.useState(!1),[w,M]=v.useState((()=>"dark"===n.palette.mode?ve:be));v.useEffect((()=>{M("dark"===n.palette.mode?ve:be)}),[n.palette.mode]);const z=async t=>{try{m(!0),C(null);const o=await fetch(`/api/books/${e}/chapters/${t}`);if(!o.ok)throw new Error("Erreur lors du chargement du chapitre.");const r=await o.json();s(r.chapter),u(r.index)}catch(o){C(o.message)}finally{m(!1)}};v.useEffect((()=>{(async()=>{try{const t=await fetch(`/api/books/${e}/chapters`);if(!t.ok)throw new Error("Erreur lors du chargement des chapitres.");const o=await t.json();x(o.chapters.length),z(0)}catch(t){C(t.message)}})()}),[e]);const[L,H]=v.useState(0);return p?t.jsx(o,{sx:{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:w.backgroundColor,color:w.textColor},children:t.jsx(b,{})}):g?t.jsxs(o,{sx:{height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:w.backgroundColor,color:w.textColor,padding:2},children:[t.jsx(r,{variant:"h6",children:g}),t.jsx(c,{onClick:()=>z(i),variant:"contained",sx:{marginTop:2},children:"Réessayer"})]}):t.jsxs(o,{sx:{height:"100vh",width:"100vw",overflow:"hidden",bgcolor:w.backgroundColor,color:w.textColor,position:"relative",display:"flex",flexDirection:"column"},children:[t.jsxs(o,{component:"header",sx:{position:"sticky",top:0,left:0,right:0,zIndex:1e3,bgcolor:`${w.backgroundColor}CC`,borderBottom:1,borderColor:"divider",px:2,py:1,display:"flex",alignItems:"center",gap:2,backdropFilter:"blur(8px)"},children:[t.jsx(l,{onClick:()=>y(!0),sx:{color:w.textColor},children:t.jsx(E,{})}),t.jsx(d,{variant:"determinate",value:i/h*100,sx:{flexGrow:1,"& .MuiLinearProgress-bar":{backgroundColor:w.textColor}}})]}),t.jsx(fe,{open:j,onClose:()=>y(!1),chapters:Array(h).fill(""),currentSection:i,onChapterSelect:e=>{z(e),y(!1)}}),t.jsxs(o,{sx:{flexGrow:1,position:"relative",overflow:"hidden"},children:[t.jsx(ee,{content:a||[],initialSection:0,bookId:e,customTheme:w,onProgressChange:t=>{localStorage.setItem(`reading-progress-${e}`,t.toString())}}),t.jsxs(o,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:w.backgroundColor,borderTop:1,borderColor:"divider",zIndex:1e3},children:[t.jsx(le,{onCommand:e=>{switch(e.toLowerCase()){case"next":i<h-1&&(z(i+1),H(0));break;case"prev":i>0&&(z(i-1),H(0))}}}),t.jsxs(r,{variant:"caption",sx:{position:"absolute",right:16,bottom:16,opacity:.7},children:[i+1," / ",h]})]})]})]})}export{Ce as default};
